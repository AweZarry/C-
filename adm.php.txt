<?php
session_start();

if (!isset($_SESSION['nome'])) {
    header("Location: ../index.php");
    exit();
}

$login = $_SESSION['nome'];


require_once('../action/Crud.php');
require_once('../database/Conexao.php');

$database = new Conexao();
$db = $database->getConnection();
$crudNomes = new CrudNomes($db);
$crudDicas = new CrudDicas($db);
$crudVideo = new CrudVideo($db);
$crudFoto = new CrudFoto($db);

if (isset($_GET['action'])) {
    switch ($_GET['action']) {
        case 'create':
            $opcao = $_POST['opcao'];

            if ($opcao == 'Capturas de Tela') {
                $crudFoto->createFoto($_POST);
                $crudNomes->create($_POST);
            } elseif ($opcao == 'Dicas') {
                $crudDicas->createDicas($_POST);
                $crudNomes->create($_POST);
            } elseif ($opcao == 'Videos') {
                $crudVideo->createVideo($_POST);
                $crudNomes->create($_POST);
            }
            break;

        case 'read':
            $rows = $crudNomes->read();
            break;

        case 'readDicas':
            $dica = $crudDicas->readDicas();
            break;

        case 'readVideo':
            $video = $crudVideo->readVideo();
            break;

        case 'readFoto':
            $foto = $crudFoto->readFoto();
            break;

        default:
            $rows = $crudNomes->read();
            $dica = $crudDicas->readDicas();
            $video = $crudVideo->readVideo();
            $foto = $crudFoto->readFoto();
            break;
    }
} else {
    $rows = $crudNomes->read();
    $dica = $crudDicas->readDicas();
    $video = $crudVideo->readVideo();
    $foto = $crudFoto->readFoto();
}

include_once('../view/navbar.php');

?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ADM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
    <script src="../public/js/adm/select.js"></script>
    <link rel="stylesheet" type="text/css" href="../public/css/adm.css">
</head>

<body>
    <div class="painel">

        <nav class="nav_canto">
            <h1>Painel de Controle do ADM</h1>
            <ul class="cimanav">
                <li>
                    <a href="#">
                        Cadastrar Carro
                    </a>
                </li>
                <li>
                    <a href="#">
                        Gerenciar Carros
                    </a>
                </li>
                <li>
                    <a href="#">
                        Excluir Carro
                    </a>
                </li>
            </ul>
            <ul class="baixonav">
                <li>
                    <a href="../public/index.php">
                        Tela Principal
                    </a>
                </li>
                <li>
                    <a href="logout.php">
                        Sair
                    </a>
                </li>
            </ul>
        </nav>

        <form method="POST" action="?action=create" enctype="multipart/form-data">

            <div>

                <label for="nome_jogo">Nome do Jogo</label>
                <input type="text" name="nome_jogo" required>
                <label for="foto_jogo">Foto do Jogo</label>
                <input type="file" name="foto_jogo" required>
                <label for="descricao">Descrição</label>
                <input type="text" name="descricap" required>

            </div>

            <div>
                <label for="categoria">Categoria</label>
                <select name="categoria" id="categoria" onchange="mostrarCampos(this.value)">
                    <option value=""></option>
                    <option value="Capturas de Tela">Capturas de Tela</option>
                    <option value="Dicas">Dicas</option>
                    <option value="Videos">Vídeos</option>
                </select>
            </div>
            <div id="captura" style="display: none;">
                <label for="titcaptura">Titulo</label>
                <input type="text" name="titcaptura">
                <label for="captura">Capturas de tela</label>
                <input type="file" name="captura">
            </div>

            <div id="subcategoria-dicas" style="display: none;">
                <label for="dicascat">Categoria de Dicas</label>
                <select name="dicascat" id="dicascat">
                    <option value=""></option>
                    <option value="Populares">Populares</option>
                    <option value="Secretos">Secretos</option>
                    <option value="Conquistas">Conquistas</option>
                    <option value="Equipamento">Equipamentos</option>
                    <option value="Armas">Armas</option>
                    <option value="Dicas Basicas">Dicas Basicas</option>
                    <option value="Mapas">Mapas</option>
                    <option value="Modificações">Modificações</option>
                    <option value="Historia">Hístoria</option>
                    <option value="Criação">Criação</option>
                    <option value="Classes">Classes</option>
                </select>
            </div>

            <div id="subcategoria-input" style="display: none;">
                <label for="titdicas">Titulo da Dica</label>
                <input type="text" name="titdicas">
                <label for="dicainput">Dicas</label>
                <input type="text" name="dicainput" id="subcategoria-input">
            </div>

            <div id="videos" style="display: none;">
                <label for="titvideo">Titulo</label>
                <input type="text" name="titvideo">
                <label for="videos">Vídeos</label>
                <input type="file" name="videos">
            </div>
            <input type="hidden" name="opcao" id="opcao" value="">
            <button type="submit">Cadastrar</button>

        </form>

        <table>
            <thead>
                <tr>
                    <th>Id Jogo</th>
                    <th>Nome do Jogo</th>
                    <th>Categoria</th>
                </tr>
            </thead>
            <tbody>
                <?php
                if (isset($rows)) {
                    foreach ($rows as $row) {
                        echo "<tr>";
                        echo "<td>" . $row['id_jogo'] . "</td>";
                        echo "<td>" . $row['nome_jogo'] . "</td>";
                        echo "<td>" . $row['categoria'] . "</td>";
                        echo "</tr>";
                    }
                } else {
                    echo "<tr><td colspan='6'>Não há registros a serem exibidos.</td></tr>";
                }
                ?>
            </tbody>
        </table>
        <table>
            <thead>
                <tr>
                    <th>Id Foto</th>
                    <th>Nome do Jogo</th>
                    <th>Titulo da Foto</th>
                    <th>Foto</th>
                </tr>
            </thead>
            <tbody>
                <?php
                if (isset($foto)) {
                    foreach ($foto as $fotos) {
                        echo "<tr>";
                        echo "<td>" . $fotos['id_foto'] . "</td>";
                        echo "<td>" . $fotos['nome_jogo'] . "</td>";
                        echo "<td>" . $fotos['titcaptura'] . "</td>";
                        echo "<td>" . $fotos['captura'] . "</td>";
                        echo "</tr>";
                    }
                } else {
                    echo "<tr><td colspan='6'>Não há registros a serem exibidos.</td></tr>";
                }
                ?>
            </tbody>
        </table>
        <table>
            <thead>
                <tr>
                    <th>Id Dicas</th>
                    <th>Nome do Jogo</th>
                    <th>Titulo da Dicas</th>
                    <th>Categoria Dicas</th>
                    <th>CrudDicas</th>
                </tr>
            </thead>
            <tbody>
                <?php
                if (isset($dica)) {
                    foreach ($dica as $dicas) {
                        echo "<tr>";
                        echo "<td>" . $dicas['id_dica'] . "</td>";
                        echo "<td>" . $dicas['nome_jogo'] . "</td>";
                        echo "<td>" . $dicas['titdicas'] . "</td>";
                        echo "<td>" . $dicas['dicascat'] . "</td>";
                        echo "<td>" . $dicas['dicasinput'] . "</td>";
                        echo "</tr>";
                    }
                } else {
                    echo "<tr><td colspan='6'>Não há registros a serem exibidos.</td></tr>";
                }
                ?>
            </tbody>
        </table>
        <table>
            <thead>
                <tr>
                    <th>Id Video</th>
                    <th>Nome do Jogo</th>
                    <th>Titulo do Video</th>
                    <th>Video</th>
                </tr>
            </thead>
            <tbody>
                <?php
                if (isset($video)) {
                    foreach ($video as $videos) {
                        echo "<tr>";
                        echo "<td>" . $videos['id_video'] . "</td>";
                        echo "<td>" . $videos['nome_jogo'] . "</td>";
                        echo "<td>" . $videos['titvideo'] . "</td>";
                        echo "<td>" . $videos['videos'] . "</td>";
                        echo "</tr>";
                    }
                } else {
                    echo "<tr><td colspan='6'>Não há registros a serem exibidos.</td></tr>";
                }
                ?>
            </tbody>
        </table>
    </div>
</body>

</html>